!function(a){"use strict";var b=null,c=function(a){this.text="",this.tags=null,this.tagsFull=null,this.priv={},this.priv.key=a;var b="http://www.api.authorship.me";this.priv.address=b+"/tags/",this.priv.userAdd=b+"/users/",this.priv.newText=!0};c.prototype.hidden={};var d=c.prototype.hidden;c.prototype.setText=function(a){this.text!==a&&(this.priv.newText=!0),this.text=a},c.prototype.getTags=function(a,b,c){"undefined"==typeof b&&(b=null),"undefined"==typeof c&&(c=null),null===this.tags||this.priv.newText===!0?(this.getTagsFull(a,function(a){null!==b&&b(this.tags)},c),this.priv.newText=!0):null!==b&&b(this.tags)},c.prototype.getTagsFull=function(a,b,c){if("undefined"==typeof b&&(b=null),"undefined"==typeof a&&(a=!1),"undefined"==typeof c&&(c=null),null===this.tags||this.priv.newText===!0){var d=this;f("POST",this.priv.address+"indexFull",g(this.text,a,this.priv.key),function(a){var c=JSON.parse(a).tags;null!==c&&(c=c.filter(function(a){return void 0!==a.tag}));for(var e in c)c[e].origin="system";null===d.tagsFull?(d.tags=c.map(function(a){return{tag:a.tag}}),d.tagsFull=c):(d.tags=d.getUserTags().concat(c.map(function(a){return{tag:a.tag}})),d.tagsFull=d.tagsFull.filter(function(a){return"custom"===a.origin}).concat(c)),null!==b&&b(c)},c)}else null!==b&&b(this.tagsFull)},c.prototype.getUserTags=function(){var a=this.tagsFull.filter(function(a){return"custom"===a.origin}),b=a.map(function(a){return a.tag});return b},c.prototype.getSystemTags=function(){var a=this.tagsFull.filter(function(a){return"system"===a.origin}),b=a.map(function(a){return a.tag});return b},c.prototype.getNumTags=function(){return null!==this.tags?this.tags.length:0},c.prototype.addTag=function(a,b,c,e){"undefined"==typeof c&&(c=null),"undefined"==typeof e&&(e=null),"undefined"==typeof b&&(b="unknown");var g=d.getTag(this.tagsFull,a);return null===g?(g=d.customTag(a,b),f("POST",this.priv.address+"create",h(g,this.text,this.priv.key),function(a){null!==c&&c(a)},e),null==this.tags?(this.tags=[{tag:a}],this.tagsFull=[g]):(this.tags.push({tag:a}),this.tagsFull.push(g)),!0):!1},c.prototype.excludeTag=function(a,b){"undefined"==typeof b&&(b=null);var c=d.getTag(this.tagsFull,a);if(null!==c){f("PUT",this.priv.address+"updateExcluded",h(c,this.text,this.priv.key),b);var e=this.tagsFull.indexOf(c);this.tagsFull.splice(e,1);var e=this.tags.indexOf(a);this.tags.splice(e,1)}},c.prototype.excludeArray=function(a,b){"undefined"==typeof b&&(b=null);for(var c in a)this.excludeTag(c.tag)},c.prototype.updateTag=function(a,b,c){if("undefined"==typeof c&&(c=null),null!==b){var e=d.getTag(this.tagsFull,a);null!==e&&(e.type=b,f("PUT",this.priv.address+"updateType",h(e,this.text,this.priv.key),null,null))}},c.prototype.getTagTypes=function(){var a={person:"Person",measure:"Measure",artWork:"Work of Art",organization:"Organization",fieldterminology:"Field terminology",location:"Location",continent:"Continent",unknown:"Tag type unknown"};return a},c.prototype.updateArray=function(a){for(var b in a)this.updateTag(a[b].tag,a[b].type)},c.prototype.addArray=function(a){for(var b in a)this.addTag(a[b].tag,a[b].type)},c.prototype.getUser=function(a,b){"undefined"==typeof a&&(a=null),"undefined"==typeof b&&(b=null),f("GET",this.priv.userAdd+"show",{apikey:this.priv.key},function(b){var c=JSON.parse(b);null!==a&&a(c.login)},b)},d.getTag=function(a,b){if(null===a)return null;for(var c=a.length,d=0;c>d;d++)if(a[d].tag==b)return a[d];return null},d.customTag=function(a,b){"undefined"==typeof b&&(b="unknown");var c={};return c.tag=a,c.type=b,c.relevance=1,c.origin="custom",c};var e=function(b){var c;return c=a.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),c.onreadystatechange=b,c},f=function(c,d,f,g,h){"undefined"==typeof g&&(g=null),"undefined"==typeof h&&(h=null);var i=e(function(a){4==i.readyState&&(200==i.status?null!==g&&g(i.responseText):(b=JSON.parse(i.responseText).error,null!==h&&h(b)))});if("GET"===c){var j="",k=!1;for(var l in f)f.hasOwnProperty(l)&&(k&&(j+="&"),j+=l+"="+encodeURI(f[l]),k=!0);i.open(c,d+"?"+j,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}else i.open(c,d,!0),i.setRequestHeader("Content-Type","application/json;charset=UTF-8");i.setRequestHeader("Origin",a.top.location.href.split("?")[0]),"GET"===c?i.send():i.send(JSON.stringify(f))},g=function(a,b,c,d){return"undefined"==typeof d&&(d=""),{apikey:c,text:a,clean:b,filename:""}},h=function(a,b,c){return{apikey:c,text:b,tag:[{name:a.tag,type:a.type,relevance:a.relevance}]}};a.Tags=c}(window);
